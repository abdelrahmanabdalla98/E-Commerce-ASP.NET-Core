@model ShopDTO

@section cssFile {
    <link href="~/css/shop.css" rel="stylesheet" />
}
<!-- Hero Section -->
<div class="breadcumb-wrapper background-image" style="background-image: url(&quot;/assets/img/bg/breadcumb-bg.jpg&quot;);">
    <div class="container">
        <div class="breadcumb-content">
            <h1 class="breadcumb-title">Shop All Products</h1>
            <ul class="breadcumb-menu">
                <li><a asp-controller="Base" asp-action="Home">Home</a></li>
                <li>Shop</li>

            </ul>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="container">
    <div class="main-content">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Filter Summary -->
            <div class="filter-summary" id="filterSummary">
                <strong>Active Filters:</strong>
                <div class="filter-tags" id="filterTags"></div>
            </div>

            <!-- Search Widget -->
            <div class="widget1">
                <h3 class="widget-title">
                    <i class="fas fa-search"></i>
                    Search Products
                </h3>
                <form id="searchForm" asp-action="Filter" method="post" class="search-form1">
                    <input type="hidden" id="dataPayload2" name="Obj" />
                    <div style="position: relative;">
                        <input type="text" id="search" class="search-input1" placeholder="Search products...">
                        <button type="button" onclick="searchFilter(this)" class="search-btn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Categories Widget -->
            <div class="widget1">
                <h3 class="widget-title">
                    <i class="fas fa-layer-group"></i>
                    Categories
                </h3>

                <ul class="category-list1">
                    <!-- Sample categories - replace with your server-side data -->
                    @{
                        if (Model.AvailableCategories.Count() > 0)
                        {
                            foreach (var category in Model.AvailableCategories)
                            {
                                <li class="category-item1">
                                    <div class="category-main1" onclick="toggleCategory(this)">
                                        <div class="category-name1">
                                            <span class="category-icon1"></span>
                                            <span onclick="toggleFilter(this, 'category', 1)">@category.Name</span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span class="category-count">@category.SubCategories.Count</span>
                                            <div class="expand-icon"></div>
                                        </div>
                                    </div>
                                    <div class="subcategories">
                                        @if (category.SubCategories != null)
                                        {
                                            @foreach (var subCategory in category.SubCategories)
                                            {
                                                <!-- Dresses Subcategory -->
                                                <div class="subcategory-item1">
                                                    <div class="subcategory-link" onclick="toggleSubcategory(this)">
                                                        <div class="subcategory-name">
                                                            <span onclick="toggleFilter(this, 'subcategory', 11)">@subCategory.Name</span>
                                                            <div class="subcategory-expand-icon"></div>
                                                        </div>
                                                        <span class="subcategory-count">@subCategory.SubCategories.Count</span>
                                                    </div>
                                                    <div class="sub-subcategories">
                                                        @if (subCategory.SubCategories != null)
                                                        {
                                                            @foreach (var subCategory2 in subCategory.SubCategories)
                                                            {
                                                                <div class="sub-subcategory-item">
                                                                    <div id="cat@(@subCategory2.Id)" class="sub-subcategory-link" onclick="toggleFilter(this, 'sub-subcategory', @subCategory2.Id)">
                                                                        <span>@subCategory2.Name</span>
                                                                        <span class="sub-subcategory-count">@subCategory2.SubCategories.Count</span>
                                                                    </div>
                                                                </div>
                                                            }
                                                        }
                                                    </div>
                                                </div>
                                            }
                                        }
                                    </div>
                                </li>
                            }

                        }
                    }
                </ul>
            </div>

            <!-- Price Filter Widget -->
            <div class="widget1 price-widget">
                <h4 class="widget-title">
                    <i class="fas fa-dollar-sign"></i>
                    Filter By Price
                </h4>
                <div class="price_slider_wrapper">
                    <!-- Current Price Display -->
                    <div class="price-display">
                        <span class="price-current" id="current-range">10 EGP - 10,000 EGP</span>
                        <span class="price-label">Range</span>
                    </div>

                    <!-- Interactive Slider -->
                    <div class="price-slider" id="price-slider">
                        <div class="slider-range" id="slider-range" style="left: 0%; width: 100%;"></div>
                        <span class="slider-handle" id="handle-min" style="left: 0%;"></span>
                        <span class="slider-handle" id="handle-max" style="left: 100%;"></span>
                    </div>

                    <!-- Price Input Fields -->
                    <div class="price-inputs">
                        <div class="price-input-group">
                            <label for="price-from">From:</label>
                            <div style="position: relative;">
                                <span class="currency-symbol">EGP</span>
                                <input type="number" id="price-from" class="price-input" value="10" min="0">
                            </div>
                        </div>
                        <div class="price-input-group">
                            <label for="price-to">To:</label>
                            <div style="position: relative;">
                                <span class="currency-symbol">EGP</span>
                                <input type="number" id="price-to" class="price-input" value="10000" min="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Size Widget -->
            <div class="widget1">
                <h3 class="widget-title">
                    <i class="fas fa-ruler"></i>
                    Size
                </h3>
                <div class="filter-grid">
                    @{
                        if (Model.AvailableSizes.Count > 0)
                        {
                            foreach (var item in Model.AvailableSizes)
                            {
                                <div id="size@(@item.Size)" class="filter-chip" onclick="toggleFilter(this, 'size','@item.Size')">
                                    <input type="checkbox" hidden>
                                    <span>@item.Size</span>
                                </div>
                            }
                        }
                    }

                </div>
            </div>

            <!-- Color Widget -->
            <div class="widget1">
                <h3 class="widget-title">
                    <i class="fas fa-palette"></i>
                    Color
                </h3>
                <div class="filter-grid">
                    @{
                        if (Model.AvailableColors.Count > 0)
                        {
                            foreach (var item in Model.AvailableColors)
                            {
                                if (item.Color != "null")
                                {
                                    <div id="color@(@item.Color.Split(':').First())" class="filter-chip color-chip" onclick="toggleFilter(this, 'color','@item.Color')">
                                        <span>@item.Color.Split(':').First()</span>
                                        <span class="color-swatch" style="background: @item.Color.Split(':').Last()"></span>
                                    </div>
                                }
                            }
                        }
                    }
                </div>
            </div>

            <!-- Filter Actions -->
            <form id="filterForm" method="post" asp-action="Filter">

                <div class="filter-actions1">
                    <input type="hidden" id="dataPayload" name="Obj" />
                    <button type="button" class="btn-primary" onclick="applyFilters()">
                        <i class="fas fa-filter"></i>
                        Apply Filters
                    </button>

                    <button type="button" class="btn-secondary1" onclick="clearAllFilters()">
                        <i class="fas fa-times"></i>
                        Clear All
                    </button>
                </div>
            </form>

        </aside>

        <!-- Products Section -->
        <main class="products-section">
            <!-- Products Header -->
            <div class="products-header1">
                <div class="results-count1" id="paginationInfo">
                    Showing 1 to 12 of 124 products
                </div>
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div class="sort-arrows" id="sortArrows" onclick="applySorting()">

                        <div class="sort-arrow up"></div>
                        <div class="sort-arrow down"></div>
                    </div>
                    <form id="sortForm" asp-action="GetPage" method="post">

                        <select asp-for="@Model.SortType" id="sortSelect" class="sort-select1" name="orderby" style="width: 250px;">
                            <option value=1>Sort by popularity</option>
                            <option value=2>Sort by average rating</option>
                            <option value=3>Sort by latest</option>
                            <option value=4>Sort by price</option>
                        </select>
                    </form>
                </div>
            </div>

            <!-- Products Grid -->
            <div class="products-grid" id="productsGrid">
                <!-- Sample Products -->
                @{
                    if (Model.Products.Count() > 0)
                    {
                        foreach (var prod in Model.Products)
                        {
                            <div class="product-card">
                                <div class="product-image">
                                    <img src="@prod.MainPhotoPath" alt="Designer Handbag">

                                    @{
                                        var DaysCount = (DateTime.Now - prod.CreatedOn).Days;
                                        if (prod.IsSale)
                                        {
                                            <span class="product-tag">On Sale</span>
                                        }
                                        else if (DaysCount < 20)
                                        {
                                            <span class="product-tag">New</span>

                                        }
                                    }

                                    <div class="product-actions">
                                        <form id="wlForm" asp-action="AddToWL" method="post">
                                            <input id="wishListId" name="Obj" hidden />
                                            <button type="button" onclick="addToWL('@prod.Id')" class="action-btn" title="Add to Wishlist">
                                                @{
                                                    if (Model.ProductsWL.Contains(prod.Id))
                                                    {
                                                        <i class="fas fa-heart"></i>

                                                    }
                                                    else
                                                    {
                                                        <i class="far fa-heart"></i>

                                                    }
                                                }
                                            </button>
                                        </form>
                                        <button class="popup-content action-btn" title="Quick View" href="#QuickView@(prod.Id)">
                                            <i class="fas fa-eye"></i>
                                        </button>

                                        <button class="action-btn" title="Add to Cart">
                                            <i class="fas fa-shopping-bag"></i>
                                        </button>

                                    </div>
                                </div>
                                <div class="product-content">
                                    @{
                                        var RatePercentM = (prod.ReviewRate * 100) / 5;
                                        <div class="product-rating">
                                            <div class="star-rating" role="img" aria-label="Rated @prod.ReviewRate out of 5">
                                                <span style="width:@RatePercentM%">
                                                    Rated
                                                    <strong class="rating">5.00</strong>
                                                    out of 5 based on <span class="rating">1</span> customer rating
                                                </span>
                                            </div>
                                            <a href="shop-details.html" class="woocommerce-review-link">(<span class="count">@prod.ReviewCount</span> customer reviews)</a>
                                        </div>
                                    }

                                    <h3 class="product-title">
                                        <a href="#">@prod.Name</a>
                                    </h3>
                                    <div class="product-price">
                                        @if (prod.Discount != null)
                                        {
                                            <span class="price-original">@Math.Round((decimal)prod.Price, 2) EGP</span>
                                            <span class="price-current">@Math.Round((decimal)prod.AfterDiscount, 2) EGP</span>
                                        }
                                        else
                                        {
                                            <span class="price-current">@prod.Price EGP</span>
                                        }
                                    </div>

                                </div>
                            </div>
                            <!-- this section is for quick view -->
                            <div class="mfp-wrap mfp-close-btn-in mfp-auto-cursor mfp-ready" tabindex="-1" style="overflow: hidden auto;display:none">
                                <div class="mfp-container mfp-s-ready mfp-inline-holder">
                                    <div class="mfp-content">
                                        <div id="QuickView@(prod.Id)" class="white-popup">
                                            <div class="container bg-white rounded-20">
                                                <div class="row gx-60">
                                                    <div class="col-lg-6">
                                                        <div class="product-big-img">
                                                            <div class="img"><img src="@prod.MainPhotoPath" alt="Product Image"></div>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-6 align-self-center">
                                                        <div class="product-about">
                                                            @{
                                                                @if (prod.Discount != null)
                                                                {
                                                                    <p class="price">@Math.Round((decimal)prod.AfterDiscount, 2) EGP <del> @Math.Round((decimal)prod.Price, 2) EGP</del></p>

                                                                }
                                                            }
                                                            <h2 class="product-title">@prod.Name</h2>
                                                            @{
                                                                var RatePercent = (prod.ReviewRate * 100) / 5;
                                                                <div class="product-rating">
                                                                    <div class="star-rating" role="img" aria-label="Rated @prod.ReviewRate out of 5">
                                                                        <span style="width:@RatePercent%">
                                                                            Rated
                                                                            <strong class="rating">5.00</strong>
                                                                            out of 5 based on <span class="rating">1</span> customer rating
                                                                        </span>
                                                                    </div>
                                                                    <a href="shop-details.html" class="woocommerce-review-link">(<span class="count">@prod.ReviewCount</span> customer reviews)</a>
                                                                </div>
                                                            }
                                                            <p class="text">@prod.Description</p>

                                                            <div class="mt-2 link-inherit">
                                                                <p>
                                                                    <strong class="text-title me-3">Availability:</strong>
                                                                    @{
                                                                        if (prod.stock.Available > 0)
                                                                        {
                                                                            <span class="stock in-stock"><i class="far fa-check-square me-2 ms-1"></i>In Stock</span>
                                                                            <div class="actions">
                                                                                <div class="quantity qtnCLass">
                                                                                    <input type="number" class="qty-input" step="1" min="1" max="@prod.stock.Available" name="quantity" value="1" title="Qty">
                                                                                    <button onclick="qtnAdjust(this,'plus',@prod.stock.Available)" class="quantity-plus qty-btn">
                                                                                        <i class="far fa-chevron-up"></i>
                                                                                    </button>
                                                                                    <button onclick="qtnAdjust(this,'minus',@prod.stock.Available)" class="quantity-minus qty-btn">
                                                                                        <i class="far fa-chevron-down"></i>
                                                                                    </button>
                                                                                </div>
                                                                                <button class="th-btn">Add to Cart</button>
                                                                                <button type="button" onclick="addToWL('@prod.Id')" class="icon-btn" title="Add to Wishlist">
                                                                                    @{
                                                                                        if (Model.ProductsWL.Contains(prod.Id))
                                                                                        {
                                                                                            <i class="fas fa-heart"></i>

                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <i class="far fa-heart"></i>

                                                                                        }
                                                                                    }
                                                                                </button>
                                                                            </div>

                                                                        }
                                                                        else
                                                                        {
                                                                            <span class="stock in-stock text-danger"> <i class="fa-solid fa-ban"></i> Out Of Stock </span>
                                                                        }
                                                                    }
                                                                </p>
                                                            </div>

                                                            <div class="product_meta">
                                                                <span class="sku_wrapper">SKU: <span class="sku">Stock:@prod.stock.stockId - @prod.stock.Id</span></span>
                                                                <span class="posted_in">Category: <a href="shop.html">@prod.category.ParentCategory.ParentCategory.Name, @prod.category.ParentCategory.Name, @prod.category.Name</a></span>
                                                                <span>Tags: <a href="shop.html">Fashion</a></span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <button title="Close (Esc)" type="button" class="mfp-close">×</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mfp-preloader">Loading...</div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div>
                            No Products Found
                        </div>
                    }
                }




            </div>

            <!-- Pagination -->
            <div class="pagination-wrapper">
                <form id="paginationForm" method="post" asp-action="GetPage">
                    <input type="hidden" id="dataPayload1" name="Obj" />
                    <ul class="pagination" id="paginationControls">
                        <li><a href="#" class="disabled"><i class="fas fa-chevron-left"></i></a></li>
                        <li><a href="#" class="active">1</a></li>
                        <li><a href="#" class="disabled"><i class="fas fa-chevron-right"></i></a></li>
                    </ul>
                </form>
            </div>
        </main>
    </div>
</div>
@section lib {
    <script>


        var retModel = @Html.Raw(Json.Serialize(Model));


        console.log(retModel);
        // State Management
        let currentFilters = {
            search: '',
            categories: [],
            sizes: [],
            colors: [],
            priceMin: 10,
            priceMax: 10000
        };
        let clearable;

        let currentPage = retModel.pageIndex;
        let itemsPerPage = 10;
        let totalItems = retModel.productsSize;
        console.log(itemsPerPage);
        // Price Slider
        let minPrice = 10;
        let maxPrice = 10000;
        let currentMin = 10;
        let currentMax = 10000;
        let isDragging = false;
        let activeHandle = null;

        // document.getElementById('sortSelect').value = retModel.sortType;

        //this is to add to wishlist
        function addToWL(value) {
            retModel.wishListProduct = value;
            retModel.wishListAdded = false;
            document.getElementById('wishListId').value = JSON.stringify(retModel);

            document.getElementById('wlForm').submit();
        }
        // Filter Management
        function toggleFilter(element, type, value) {
            element.classList.toggle('active');

            if (element.classList.contains('active')) {
                if (type == "sub-subcategory") {
                    currentFilters.categories.push(value);
                }
                else if (type == "size") {
                    currentFilters.sizes.push(value);

                }
                else if (type == "color") {
                    currentFilters.colors.push(value);

                }
            }
            else {
                if (type == "sub-subcategory") {
                    currentFilters.categories.pop();
                }
                else if (type == "size") {
                    currentFilters.sizes.pop();

                }
                else if (type == "color") {
                    currentFilters.colors.pop();

                }
                console.log(currentFilters);
            }

            // Add ripple effect
            const rect = element.getBoundingClientRect();
            const ripple = document.createElement('div');
            ripple.style.cssText = `
                                                                                                position: absolute;
                                                                                                border-radius: 50%;
                                                                                                background: rgba(253, 91, 68, 0.3);
                                                                                                transform: scale(0);
                                                                                                animation: ripple 0.6s linear;
                                                                                                pointer-events: none;
                                                                                                width: 40px;
                                                                                                height: 40px;
                                                                                                left: 50%;
                                                                                                top: 50%;
                                                                                                margin-left: -20px;
                                                                                                margin-top: -20px;
                                                                                            `;

            element.style.position = 'relative';
            element.appendChild(ripple);

            setTimeout(() => ripple.remove(), 600);

            // Update filters based on type
            updateFilters();
        }

        function toggleCategory(element) {
            const subcategories = element.parentElement.querySelector('.subcategories');
            const expandIcon = element.querySelector('.expand-icon');

            if (subcategories.classList.contains('show')) {
                subcategories.classList.remove('show');
                expandIcon.style.transform = 'rotate(45deg)';
            } else {
                subcategories.classList.add('show');
                expandIcon.style.transform = 'rotate(225deg)';
            }
        }
        function toggleSubcategory(element) {
            const subcategories = element.parentElement.querySelector('.sub-subcategories');
            const expandIcon = element.querySelector('.subcategory-expand-icon');

            if (subcategories.classList.contains('show')) {
                subcategories.classList.remove('show');
                expandIcon.style.transform = 'rotate(45deg)';
            } else {
                subcategories.classList.add('show');
                expandIcon.style.transform = 'rotate(225deg)';
            }
        }


        function updateFilters() {
            // Update filter summary
            updateFilterSummary();

            // You can add AJAX call here to update products
            console.log('Current filters:', currentFilters);
        }

        function updateFilterSummary() {
            const filterSummary = document.getElementById('filterSummary');
            const filterTags = document.getElementById('filterTags');

            const activeFilters = [];

            // Add search filter
            if (currentFilters.search) {
                activeFilters.push({ type: 'search', value: currentFilters.search });
            }
            if (currentFilters.priceMin > 10) {
                activeFilters.push({ type: 'From_Price', value: currentFilters.priceMin });

            }
            if (currentFilters.priceMax < 10000) {
                activeFilters.push({ type: 'To_Price', value: currentFilters.priceMax });

            }

            // Add category filters
            currentFilters.categories.forEach(cat => {
                activeFilters.push({ type: 'category', value: cat });
            });

            // Add size filters
            currentFilters.sizes.forEach(size => {
                activeFilters.push({ type: 'size', value: size });
            });

            // Add color filters
            currentFilters.colors.forEach(color => {
                activeFilters.push({ type: 'color', value: color });
            });

            if (activeFilters.length > 0) {
                filterSummary.classList.add('active');
                filterTags.innerHTML = activeFilters.map(filter => `
                                                                                                    <span class="filter-tag">
                                                                                                        ${filter.type} : ${filter.value}
                                                                                                        <button onclick="removeFilter('${filter.type}', '${filter.value}')">
                                                                                                            <i class="fas fa-times"></i>
                                                                                                        </button>
                                                                                                    </span>
                                                                                                `).join('');
            } else {
                filterSummary.classList.remove('active');
            }
            clearable = activeFilters.length;


        }

        function removeFilter(type, value) {
            // Remove specific filter and update UI
            var id;
            if (type == "search") {
                currentFilters.search = '';
                document.getElementById('search').value = '';
            }
            else if (type == "color") {
                id = "color" + value.split(":", 1);
                currentFilters.colors = currentFilters.colors.filter(color => color !== value);
                document.getElementById(id).classList.remove('active');
            }
            else if (type == "size") {
                id = "size" + value;
                index = currentFilters.sizes.indexOf(value);
                currentFilters.sizes = currentFilters.sizes.filter(size => size !== value);
                document.getElementById(id).classList.remove('active');

            }
            else if (type == "category") {
                id = "cat" + parseInt(value);
                currentFilters.categories = currentFilters.categories.filter(catg => catg !== parseInt(value));
                document.getElementById(id).classList.remove('active');

            }
            else if (type == "From_Price") {
                currentFilters.priceMin = minPrice;
                currentMin = minPrice;
            }
            else if (type == "To_Price") {
                currentFilters.priceMax = maxPrice;
                currentMax = maxPrice;
            }
            updatePriceDisplay();
            updateFilterSummary();


            if (clearable == 0) {
                document.getElementById('dataPayload1').value = JSON.stringify(retModel);
                document.getElementById('paginationForm').submit();

            }
        }
        function searchFilter(element) {
            //this to call filter post method for filter search
            retModel.filter = currentFilters;
            document.getElementById('dataPayload2').value = JSON.stringify(retModel);
            document.getElementById('searchForm').submit();
        }
        function applyFilters() {
            // Add loading state
            const btn = event.target;
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<div class="spinner"></div>Applying...';
            btn.disabled = true;
            setTimeout(() => {
                btn.innerHTML = originalHTML;
                btn.disabled = false;

                // var request = {
                //     search: "dd",
                //     categories: currentFilters.categories,
                //     categoryElements: currentFilters.categoryElements,
                //     sizes: currentFilters.sizes,
                //     sizeElements: currentFilters.sizeElements,
                //     colors: currentFilters.colors,
                //     colorElements: currentFilters.colorElements,
                //     priceMin: currentFilters.priceMin,
                //     priceMax: currentFilters.priceMax

                // };

                retModel.filter = currentFilters;

                console.log(retModel.filter, "ret");
                document.getElementById("dataPayload").value = JSON.stringify(retModel);

                if (currentFilters.search != "" || currentFilters.categories.length > 0 || currentFilters.colors.length > 0
                    || currentFilters.sizes.length > 0
                    || currentFilters.priceMin != minPrice
                    || currentFilters.priceMax != maxPrice) {
                    // Show success feedback
                    btn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                    btn.innerHTML = '<i class="fas fa-check"></i>Applied!';
                    setTimeout(() => {
                        btn.innerHTML = originalHTML;
                        btn.style.background = '';

                    }, 2000);

                    document.getElementById('filterForm').submit();
                }

                // ajax call
                // $.ajax({
                //     url: "/Base/Filter",
                //     type: "POST", // or "POST"
                //     data: JSON.stringify(request), // Convert object to JSON string
                //     contentType: "application/json; charset=utf-8",
                //     success: function (response) {
                //     },
                //     error: function (xhr, status, error) {
                //         console.error("Error:", error);
                //     }
                // });

                // fetch('/Base/Filter', {
                //     method: 'POST',
                //     headers: {
                //         'Content-Type': 'application/json'
                //     },
                //     body: JSON.stringify(request)
                // })
                //     .then(response => response.text())
                //     .then(html => {
                //         document.body.innerHTML = html; // Replace page content with returned view
                //     });

            }, 1000);

            console.log('Applying filters:', currentFilters);
        }

        function clearAllFilters() {
            // var valid = false;
            // // Reset all filters
            // document.querySelectorAll('.filter-chip.active').forEach(chip => {
            //     chip.classList.remove('active');
            // });

            // document.querySelectorAll('.sub-subcategory-link.active').forEach(cat => {
            //     cat.classList.remove('active');
            // });

            // document.getElementById('search').value = '';
            // // Reset price slider
            // currentMin = minPrice;
            // currentMax = maxPrice;
            // updatePriceDisplay();

            // if (currentFilters.search != "" || currentFilters.categories.length > 0 || currentFilters.colors.length > 0
            //     || currentFilters.sizes.length > 0
            //     || currentFilters.priceMin != minPrice
            //     || currentFilters.priceMax != maxPrice) {
            //     valid = true;
            // }
            // console.log(currentFilters);

            if (clearable > 0) {
                // Reset filter state
                currentFilters = {
                    search: '',
                    categories: [],
                    sizes: [],
                    colors: [],
                    priceMin: minPrice,
                    priceMax: maxPrice
                };

                retModel.filter = currentFilters;

                document.getElementById('dataPayload1').value = JSON.stringify(retModel);
                // updateFilterSummary();
                // Add clear feedback
                const btn = event.target;
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i>Cleared!';
                btn.style.background = '#10b981';

                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                    btn.style.background = '';

                    document.getElementById('paginationForm').submit();

                    // if (valid) {
                    //     // window.location.href = "/Base/Index";
                    // }

                }, 1500);
            }

        }

        // Price Slider Functionality
        function updatePriceDisplay() {
            document.getElementById('current-range').textContent = `${currentMin} EGP - ${currentMax.toLocaleString()} EGP`;
            document.getElementById('price-from').value = currentMin;
            document.getElementById('price-to').value = currentMax;

            const minPercent = ((currentMin - minPrice) / (maxPrice - minPrice)) * 100;
            const maxPercent = ((currentMax - minPrice) / (maxPrice - minPrice)) * 100;

            const range = document.getElementById('slider-range');
            const minHandle = document.getElementById('handle-min');
            const maxHandle = document.getElementById('handle-max');

            if (range && minHandle && maxHandle) {
                range.style.left = minPercent + '%';
                range.style.width = (maxPercent - minPercent) + '%';
                minHandle.style.left = minPercent + '%';
                maxHandle.style.left = maxPercent + '%';
            }

        }

        function initPriceSlider() {
            const slider = document.getElementById('price-slider');
            const minHandle = document.getElementById('handle-min');
            const maxHandle = document.getElementById('handle-max');

            if (!slider || !minHandle || !maxHandle) return;

            function handleMouseDown(e, handle) {
                isDragging = true;
                activeHandle = handle;
                e.preventDefault();
            }

            function handleMouseMove(e) {
                if (!isDragging || !activeHandle) return;

                const rect = slider.getBoundingClientRect();
                const percent = Math.max(0, Math.min(100, ((e.clientX - rect.left) / rect.width) * 100));
                const value = Math.round(minPrice + (percent / 100) * (maxPrice - minPrice));

                if (activeHandle === minHandle) {
                    currentMin = Math.min(value, currentMax - 50);
                } else {
                    currentMax = Math.max(value, currentMin + 50);
                }
                currentFilters.priceMin = currentMin;
                currentFilters.priceMax = currentMax;

                updatePriceDisplay();
                updateFilterSummary();
            }

            function handleMouseUp() {
                isDragging = false;
                activeHandle = null;
            }

            minHandle.addEventListener('mousedown', (e) => handleMouseDown(e, minHandle));
            maxHandle.addEventListener('mousedown', (e) => handleMouseDown(e, maxHandle));
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);

            // Touch events for mobile
            minHandle.addEventListener('touchstart', (e) => handleMouseDown(e.touches[0], minHandle));
            maxHandle.addEventListener('touchstart', (e) => handleMouseDown(e.touches[0], maxHandle));
            document.addEventListener('touchmove', (e) => e.touches[0] && handleMouseMove(e.touches[0]));
            document.addEventListener('touchend', handleMouseUp);
        }

        // Search functionality
        function setupSearch() {
            const searchInput = document.getElementById('search');
            let searchTimeout;

            searchInput.addEventListener('input', function () {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    currentFilters.search = this.value.trim();
                    updateFilters();
                }, 300);
            });
        }

        // Pagination
        function changePage(page) {
            if (page < 1 || page > Math.ceil(totalItems / itemsPerPage)) return;

            currentPage = page;

            retModel.pageIndex = currentPage;
            document.getElementById('dataPayload1').value = JSON.stringify(retModel);


            // //call ajax call to get second 10 items
            // window.location.href = `/Base/Index?PageIndex=${currentPage}&PageSize=${itemsPerPage}`;

            updatePaginationInfo();
            updatePaginationControls();

            // Smooth scroll to top of products
            document.querySelector('.products-section').scrollIntoView({
                behavior: 'smooth'
            });
            document.getElementById('paginationForm').submit();
        }

        function updatePaginationInfo(_type) {
            // itemsPerPage = retModel.products.length;

            if (_type == "Filtered") {
                document.getElementById('paginationInfo').textContent =
                    `${retModel.products.length} results products count`;
            } else {
                const startItem = ((currentPage - 1) * itemsPerPage) + 1;
                const endItem = Math.min(currentPage * itemsPerPage, totalItems);
                document.getElementById('paginationInfo').textContent =
                    `Showing ${startItem} to ${endItem} of ${totalItems} products`;
            }
        }

        function updatePaginationControls() {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            console.log(totalPages, "asfas");
            const paginationControls = document.getElementById('paginationControls');

            let html = `<li><a href="#" onclick="changePage(${currentPage - 1})" class="${currentPage === 1 ? 'disabled' : ''}"><i class="fas fa-chevron-left"></i></a></li>`;

            for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
                html += `<li><a href="#" onclick="changePage(${i})" class="${i === currentPage ? 'active' : ''}">${i}</a></li>`;
            }

            html += `<li><a href="#" onclick="changePage(${currentPage + 1})" class="${currentPage === totalPages ? 'disabled' : ''}"><i class="fas fa-chevron-right"></i></a></li>`;

            paginationControls.innerHTML = html;
        }

        // Animation styles
        const animationStyles = `
                                                                                            @@keyframes ripple {
                                                                                                to {
                                                                                                    transform: scale(4);
                                                                                                    opacity: 0;
                                                                                                }
                                                                                            }

                                                                                            @@keyframes fadeInUp {
                                                                                                from {
                                                                                                    opacity: 0;
                                                                                                    transform: translateY(30px);
                                                                                                }
                                                                                                to {
                                                                                                    opacity: 1;
                                                                                                    transform: translateY(0);
                                                                                                }
                                                                                            }

                                                                                            .product-card {
                                                                                                animation: fadeInUp 0.6s ease forwards;
                                                                                            }

                                                                                            .product-card:nth-child(1) { animation-delay: 0.1s; }
                                                                                            .product-card:nth-child(2) { animation-delay: 0.2s; }
                                                                                            .product-card:nth-child(3) { animation-delay: 0.3s; }
                                                                                            .product-card:nth-child(4) { animation-delay: 0.4s; }
                                                                                            .product-card:nth-child(5) { animation-delay: 0.5s; }
                                                                                            .product-card:nth-child(6) { animation-delay: 0.6s; }
                                                                                        `;

        document.getElementById('sortSelect').addEventListener('change', function (e) {
            e.preventDefault();
            const val = this.value;


            retModel.sortType = parseInt(val);

            const element = document.createElement('input');
            element.type = "hidden";
            element.name = "Obj";
            element.value = JSON.stringify(retModel);
            this.parentElement.appendChild(element);
            this.parentElement.submit();

        });
        document.querySelectorAll('.qty-input').forEach(input => {
            input.addEventListener('input', () => {
                if (input.value < 1) {
                    input.value = 1;
                }
            });

            // Optional: block minus key
            input.addEventListener('keydown', (e) => {
                if (e.key === '-' || e.key === 'Subtract') {
                    e.preventDefault();
                }
            });
        });
        function qtnAdjust(element, type, qtnValue) {
            const parent = element.closest('.qtnCLass');
            const input = parent.querySelector('.qty-input');
            if (type == "plus") {
                if (input.value <= qtnValue) {
                    input.value = parseInt(input.value) + 1;

                }
            }
            else {
                if (input.value > 1) {
                    input.value = parseInt(input.value) - 1;

                }
            }
        }
        // document.querySelectorAll('.qtnCLass').forEach(container => {
        //     const input = container.querySelector('.qty-input');
        //     const plusBtn = container.querySelector('.quantity-plus');
        //     const minusBtn = container.querySelector('.quantity-minus');
        //     plusBtn.addEventListener('click', function () {
        //         if()
        //         input.value = parseInt(input.value) + 1;
        //     });
        //     minusBtn.addEventListener('click', function () {

        //         input.value = parseInt(input.value) - 1;
        //     });

        //     console.log(input.value); // or manipulate it
        // });


        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', function () {
            // var filters = @Html.Raw(Json.Serialize(ViewBag.Filters));
            // if (filters != null) {
            //     currentFilters.priceMin = filters.priceMin;
            //     currentFilters.sizes.push(filters.sizes[0]);
            //     updateFilters();
            // }


            console.log(retModel, "ssss");
            var check = false;
            if (retModel.filter != null) {

                currentFilters = retModel.filter;
                if (currentFilters.categories.length != 0) {
                    currentFilters.categories.forEach(cat => {
                        document.getElementById("cat" + cat).classList.add('active');
                    });
                    check = true;
                }
                if (currentFilters.sizes.length != 0) {
                    currentFilters.sizes.forEach(size => {
                        document.getElementById("size" + size).classList.add('active');
                    });
                    check = true;
                }
                if (currentFilters.colors.length != 0) {
                    currentFilters.colors.forEach(color => {
                        document.getElementById("color" + color.split(":", 1)).classList.add('active');
                    });
                    check = true;
                }
                if (currentFilters.search != "") {
                    document.getElementById('search').value = currentFilters.search;
                    check = true;

                }

                if (currentFilters.priceMin > currentMin || currentFilters.priceMax < currentMax) {
                    check = true;
                }
                currentMin = currentFilters.priceMin;
                currentMax = currentFilters.priceMax;
                updateFilters();
            }

            if (retModel.wishListAdded != null) {
                if (retModel.wishListAdded == true) {
                    Swal.fire({
                        title: 'Wishlist Updated!',
                        text: 'Your item is now saved for later',
                        icon: 'success',
                        timer: 2000,
                        timerProgressBar: true,
                        showConfirmButton: false,
                        toast: true,
                        position: 'top-end'
                    });
                }
                else {
                    Swal.fire({
                        title: 'Wishlist Updated!',
                        text: 'Your item is removed from wish list',
                        icon: 'success',
                        timer: 2000,
                        timerProgressBar: true,
                        showConfirmButton: false,
                        toast: true,
                        position: 'top-end'
                    });
                }
            }
            // Add animation styles
            const styleSheet = document.createElement('style');
            styleSheet.textContent = animationStyles;
            document.head.appendChild(styleSheet);

            // Initialize components
            if (check == true) {
                itemsPerPage = retModel.productsSize;
                updatePaginationInfo("Filtered");
            }
            else {
                updatePaginationInfo();
            }
            initPriceSlider();
            setupSearch();
            updatePriceDisplay();

            updatePaginationControls();

            // Add smooth scroll behavior
            document.documentElement.style.scrollBehavior = 'smooth';

            // Price input event listeners
            document.getElementById('price-from').addEventListener('input', function () {
                const value = parseInt(this.value) || minPrice;
                currentMin = Math.max(minPrice, Math.min(value, currentMax - 50));
                updatePriceDisplay();
                currentFilters.priceMin = currentMin;
            });

            document.getElementById('price-to').addEventListener('input', function () {
                const value = parseInt(this.value) || maxPrice;
                currentMax = Math.min(maxPrice, Math.max(value, currentMin + 50));
                updatePriceDisplay();
                currentFilters.priceMax = currentMax;
            });

            // Intersection Observer for product cards animation
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);

            // Observe all product cards
            document.querySelectorAll('.product-card').forEach(card => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(30px)';
                card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(card);
            });
            // Sort functionality for product grid
            document.getElementById('sortArrows').className = 'sort-arrows asc';

            // Add keyboard support
            document.addEventListener('keydown', function (e) {
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    toggleSort();
                }
            });

        });


        function applySorting() {

            const element = document.getElementById('sortArrows');
            if (element.classList.contains('asc')) {
                element.className = 'sort-arrows desc';
                showSortFeedback('desc');
                retModel.sortDir = "desc";
            }
            else {
                element.className = 'sort-arrows asc';
                showSortFeedback('asc');
                retModel.sortDir = "asc";


            }
            const productGrid = document.getElementById('productsGrid');
            if (!productGrid) return;

            const products = Array.from(productGrid.children);
            const sortedProducts = products.reverse();

            console.log(sortedProducts, "ss");


            // Clear the grid and re-append sorted products with animation
            productGrid.innerHTML = '';

            // Add products with staggered animation
            sortedProducts.forEach((product, index) => {
                product.style.opacity = '0';
                product.style.transform = 'translateY(30px)';
                productGrid.appendChild(product);

                // Animate in with delay
                setTimeout(() => {
                    product.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                    product.style.opacity = '1';
                    product.style.transform = 'translateY(0)';
                }, index * 100);
            });

        }
        function runt() {
            window.location.reload();

        }
        function showSortFeedback(direction) {
            // Remove existing feedback
            const existing = document.querySelector('.sort-feedback');
            if (existing) existing.remove();

            // Create feedback element
            const feedback = document.createElement('div');
            feedback.className = 'sort-feedback';
            feedback.style.cssText = `
                                                                                position: fixed;
                                                                                top: 20px;
                                                                                right: 20px;
                                                                                background: var(--primary-color);
                                                                                color: white;
                                                                                padding: 12px 20px;
                                                                                border-radius: var(--radius-md);
                                                                                box-shadow: var(--shadow-lg);
                                                                                z-index: 1000;
                                                                                font-weight: 500;
                                                                                font-size: 14px;
                                                                                transform: translateX(100%);
                                                                                transition: transform 0.3s ease;
                                                                                display: flex;
                                                                                align-items: center;
                                                                                gap: 8px;
                                                                            `;

            const directionIcon = direction === 'asc' ? '↑' : '↓';
            const directionText = direction === 'asc' ? 'ascending' : 'descending';

            feedback.innerHTML = `
                                                                                <i class="fas fa-sort"></i>
                                                                                Sorted by ${directionIcon} (${directionText})
                                                                            `;

            document.body.appendChild(feedback);

            // Animate in
            setTimeout(() => {
                feedback.style.transform = 'translateX(0)';
            }, 100);

            // Animate out and remove
            setTimeout(() => {
                feedback.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (feedback.parentNode) {
                        feedback.remove();
                    }
                }, 300);
            }, 3000);
        }

        // Add to cart functionality (placeholder)
        function addToCart(productId) {
            // Add cart animation
            const btn = event.target;
            btn.style.transform = 'scale(0.95)';

            setTimeout(() => {
                btn.style.transform = 'scale(1)';
                // Here you would make an AJAX call to add to cart
                console.log('Added product to cart:', productId);
            }, 150);
        }

        // Wishlist functionality (placeholder)
        function toggleWishlist(element, productId) {
            element.classList.toggle('active');
            const icon = element.querySelector('i');

            if (element.classList.contains('active')) {
                icon.className = 'fas fa-heart';
                element.style.color = '#fd5b44';
            } else {
                icon.className = 'far fa-heart';
                element.style.color = '';
            }

            console.log('Toggled wishlist for product:', productId);
        }
    </script>
}

@*     check it important
                                         search all stocks to check all colors of product
                                     <div class="color-options">
 <div class="color-title">Available Colors:</div>
 <div class="color-swatches">
         <div class="color-option" style="background: #8B4513;"></div>
         <div class="color-option" style="background: #000000;"></div>
         <div class="color-option" style="background: #ff69b4;"></div>

    </div>

</div> *@

@* <h3 class="product-title">
    <a href="#">@prod.Name</a>  //handle it later
</h3> *@