@model WishlistDTO

<link href="~/css/shop.css" rel="stylesheet" />

<!-- Breadcrumb -->
<div class="breadcumb-wrapper background-image" style="background-image: url('/assets/img/bg/breadcumb-bg.jpg');">
    <div class="container">
        <div class="breadcumb-content">
            <h1 class="breadcumb-title">My Wishlist</h1>
            <ul class="breadcumb-menu">
                <li><a asp-controller="Base" asp-action="Home">Home</a></li>
                <li>Wishlist</li>
            </ul>
        </div>
    </div>
</div>

<!-- Main Wishlist Container -->
<div class="wishlist-container">
    <div class="container">
        <!-- Wishlist Header -->
        <div class="wishlist-header">
            <h1 class="wishlist-title">
                <i class="fas fa-heart"></i>
                My Wishlist
            </h1>
            <p class="wishlist-subtitle">Save your favorite items for later</p>

            <div class="wishlist-actions">
                <div class="wishlist-count" id="wishlistCount">
                    @if (Model?.WishlistItems?.Count() > 0)
                    {
                        <text>@Model.WishlistItems.Count() items in your wishlist</text>
                    }
                    else
                    {
                        <text>Your wishlist is empty</text>
                    }
                </div>
                <div class="wishlist-controls">
                    @if (Model?.WishlistItems?.Count() > 0)
                    {
                        <button type="button" class="btn-clear-all" onclick="clearAllWishlist()">
                            <i class="fas fa-trash"></i>
                            Clear All
                        </button>
                    }
                    <button type="button" class="btn-share" onclick="shareWishlist()">
                        <i class="fas fa-share"></i>
                        Share Wishlist
                    </button>
                </div>
            </div>
        </div>

        <!-- Wishlist Items -->
        @if (Model?.WishlistItems?.Count() > 0)
        {
            <div class="wishlist-items" id="wishlistItems">
                @foreach (var item in Model.WishlistItems)
                {
                    <div class="wishlist-item" id="wishlist-item-@item.productId">
                        <!-- Product Image -->
                        <div class="wishlist-item-image">
                            <img src="@item.product.MainPhotoPath" alt="@item.product.Name">
                            @{
                                var daysCount = (DateTime.Now - item.product.CreatedOn).Days;
                                if (item.product.IsSale)
                                {
                                    <span class="product-badge">Sale</span>
                                }
                                else if (daysCount < 20)
                                {
                                    <span class="product-badge">New</span>
                                }
                            }
                        </div>

                        <!-- Product Details -->
                        <div class="wishlist-item-details">
                            <h3 class="wishlist-item-title">
                                <a href="#" onclick="viewProduct(@item.productId)">@item.product.Name</a>
                            </h3>

                            <div class="wishlist-item-meta">
                                <div class="meta-item">
                                    <i class="fas fa-layer-group meta-icon"></i>
                                    <span>@item.product.category?.Name</span>
                                </div>
                                <div class="meta-item">
                                    <i class="fas fa-calendar-plus meta-icon"></i>
                                    <span>Added @item.CreatedOn.ToString("MMM dd, yyyy")</span>
                                </div>
                            </div>

                            <div class="wishlist-item-rating">
                                <div class="rating-stars">
                                    @for (int i = 0; i < 5; i++)
                                    {
                                        if (i < item.product.ReviewRate)
                                        {
                                            <i class="fas fa-star rating-star"></i>
                                        }
                                        else
                                        {
                                            <i class="fal fa-star rating-star" style="color: #e2e8f0;"></i>
                                        }
                                    }
                                </div>
                                <span class="rating-text">(@item.product.ReviewCount reviews)</span>
                            </div>

                            <p class="wishlist-item-description">@item.product.Description</p>

                            <div class="wishlist-item-footer">
                                <div class="wishlist-item-price">
                                    @if (item.product.Discount != null)
                                    {
                                        <span class="price-current">@Math.Round((decimal)item.product.AfterDiscount, 2) EGP</span>
                                        <span class="price-original">@Math.Round((decimal)item.product.Price, 2) EGP</span>
                                    }
                                    else
                                    {
                                        <span class="price-current">@item.product.Price EGP</span>
                                    }
                                </div>

                                <div style="display: flex; align-items: center; gap: 12px;">
                                    @if (item.product.stock?.Quantity > 0)
                                    {
                                        <span class="stock-status in-stock">In Stock</span>
                                    }
                                    else
                                    {
                                        <span class="stock-status out-of-stock">Out of Stock</span>
                                    }
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="wishlist-item-actions">
                            @if (item.product.stock?.Quantity > 0)
                            {
                                <button class="btn-add-to-cart" onclick="addToCart(@item.productId)">
                                    <i class="fas fa-shopping-cart"></i>
                                    Add to Cart
                                </button>
                            }
                            else
                            {
                                <button class="btn-add-to-cart" disabled>
                                    <i class="fas fa-ban"></i>
                                    Out of Stock
                                </button>
                            }


                            <button class="btn-remove" onclick="removeFromWishlist(@item.productId)">
                                <i class="fas fa-times"></i>
                                Remove
                            </button>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <!-- Empty Wishlist State -->
            <div class="empty-wishlist">
                <i class="fas fa-heart-broken"></i>
                <h3>Your wishlist is empty</h3>
                <p>Start adding products to your wishlist by clicking the heart icon on any product.</p>
                <a href="@Url.Action("Index", "Base")" class="btn-start-shopping">
                    <i class="fas fa-shopping-bag"></i>
                    Start Shopping
                </a>
            </div>
        }
    </div>
</div>
@section lib{
<script>
    // Wishlist Management Functions
    function addToCart(productId) {
        const btn = event.target;
        const originalHTML = btn.innerHTML;

        // Add loading state
        btn.classList.add('btn-loading');
        btn.innerHTML = '<div style="width: 20px; height: 20px; border: 2px solid rgba(255,255,255,0.3); border-top: 2px solid white; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>';
        btn.disabled = true;

        // Simulate API call
        setTimeout(() => {
            btn.classList.remove('btn-loading');
            btn.innerHTML = '<i class="fas fa-check"></i>Added!';
            btn.style.background = '#10b981';

            // Show success notification
            showNotification('Product added to cart successfully!', 'success');

            setTimeout(() => {
                btn.innerHTML = originalHTML;
                btn.style.background = '';
                btn.disabled = false;
            }, 2000);

            // Here you would make the actual AJAX call to add to cart
            console.log('Added product to cart:', productId);
        }, 1000);
    }

    function removeFromWishlist(productId) {
        if (confirm('Are you sure you want to remove this item from your wishlist?')) {
            const itemElement = document.getElementById(`wishlist-item-${productId}`);

            // Add removal animation
            itemElement.classList.add('removing');

            setTimeout(() => {
                itemElement.remove();
                updateWishlistCount();
                showNotification('Item removed from wishlist', 'info');

                // Check if wishlist is now empty
                const remainingItems = document.querySelectorAll('.wishlist-item').length;
                if (remainingItems === 0) {
                    location.reload(); // Reload to show empty state
                }
            }, 300);

            // Here you would make the actual AJAX call to remove from wishlist
            console.log('Removed product from wishlist:', productId);
        }
    }

    function clearAllWishlist() {
        if (confirm('Are you sure you want to clear your entire wishlist? This action cannot be undone.')) {
            const items = document.querySelectorAll('.wishlist-item');

            items.forEach((item, index) => {
                setTimeout(() => {
                    item.classList.add('removing');
                    setTimeout(() => item.remove(), 300);
                }, index * 100);
            });

            setTimeout(() => {
                location.reload(); // Reload to show empty state
            }, items.length * 100 + 500);

            showNotification('Wishlist cleared successfully', 'info');

            // Here you would make the actual AJAX call to clear wishlist
            console.log('Cleared entire wishlist');
        }
    }

    function shareWishlist() {
        if (navigator.share) {
            navigator.share({
                title: 'Check out my wishlist!',
                text: 'Take a look at the products I\'m interested in',
                url: window.location.href
            });
        } else {
            // Fallback for browsers that don't support Web Share API
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                showNotification('Wishlist link copied to clipboard!', 'success');
            }).catch(() => {
                // Create a temporary input to copy the URL
                const tempInput = document.createElement('input');
                tempInput.value = url;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                showNotification('Wishlist link copied to clipboard!', 'success');
            });
        }
    }

    function viewProduct(productId) {
        // Navigate to product details page
        window.location.href = `/Product/Details/${productId}`;
    }

    function updateWishlistCount() {
        const items = document.querySelectorAll('.wishlist-item').length;
        const countElement = document.getElementById('wishlistCount');

        if (items === 0) {
            countElement.textContent = 'Your wishlist is empty';
        } else {
            countElement.textContent = `${items} item${items !== 1 ? 's' : ''} in your wishlist`;
        }
    }

    function showNotification(message, type = 'info') {
        // Remove existing notification
        const existing = document.querySelector('.notification');
        if (existing) existing.remove();

        // Create notification element
        const notification = document.createElement('div');
        notification.className = 'added-to-cart';

        const bgColor = {
            'success': '#10b981',
            'error': '#dc2626',
            'info': '#3b82f6'
        };

        notification.style.background = bgColor[type] || bgColor.info;
        notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}"></i>
                ${message}
            `;

        document.body.appendChild(notification);

        // Animate in
        setTimeout(() => {
            notification.classList.add('show');
        }, 100);

        // Animate out and remove
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 300);
        }, 3000);
    }

    // Add CSS for spin animation
    const style = document.createElement('style');
    style.textContent = `
            @@keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
    document.head.appendChild(style);

    // Initialize page
    document.addEventListener('DOMContentLoaded', function () {
        // Add smooth scroll behavior
        document.documentElement.style.scrollBehavior = 'smooth';

        // Intersection Observer for wishlist items animation
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateX(0)';
                }
            });
        }, observerOptions);

        // Observe all wishlist items
        document.querySelectorAll('.wishlist-item').forEach((item, index) => {
            item.style.opacity = '0';
            item.style.transform = 'translateX(-30px)';
            item.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
            observer.observe(item);
        });
    });
</script>
}