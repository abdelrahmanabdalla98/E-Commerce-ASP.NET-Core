@model WishlistDTO

<style>
    /* CSS Variables - matching your existing design */
    :root {
        --primary-color: #fd5b44;
        --primary-light: rgba(253, 91, 68, 0.1);
        --primary-dark: #e54d37;
        --text-dark: #1a1a1a;
        --text-medium: #4a5568;
        --text-light: #718096;
        --bg-light: #f8fafc;
        --white: #ffffff;
        --border-light: #e2e8f0;
        --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
        --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
        --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
        --radius-sm: 8px;
        --radius-md: 12px;
        --radius-lg: 16px;
        --radius-xl: 24px;
    }

    /* Wishlist specific styles */
    .wishlist-container {
        padding: 60px 0;
        background: var(--bg-light);
        min-height: 70vh;
    }

    .wishlist-header {
        background: white;
        padding: 32px;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-lg);
        margin-bottom: 32px;
        border: 1px solid var(--border-light);
    }

    .wishlist-title {
        font-size: 28px;
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .wishlist-title::before {
        content: '';
        width: 6px;
        height: 32px;
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        border-radius: 3px;
    }

    .wishlist-subtitle {
        color: var(--text-medium);
        font-size: 16px;
        font-weight: 500;
    }

    .wishlist-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 24px;
        padding-top: 24px;
        border-top: 1px solid var(--border-light);
    }

    .wishlist-count {
        color: var(--text-medium);
        font-weight: 500;
        font-size: 14px;
    }

    .wishlist-controls {
        display: flex;
        gap: 12px;
        align-items: center;
    }

    .btn-clear-all {
        background: white;
        color: #dc2626;
        border: 2px solid #dc2626;
        padding: 10px 20px;
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn-clear-all:hover {
        background: #dc2626;
        color: white;
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
    }

    .btn-share {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn-share:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
        box-shadow: 0 8px 25px rgba(253, 91, 68, 0.3);
    }

    /* Wishlist Items Container */
    .wishlist-items {
        background: white;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-lg);
        overflow: hidden;
        border: 1px solid var(--border-light);
    }

    .wishlist-item {
        display: flex;
        align-items: center;
        padding: 24px 32px;
        border-bottom: 1px solid var(--border-light);
        transition: all 0.3s ease;
        position: relative;
        background: white;
    }

    .wishlist-item:hover {
        background: var(--bg-light);
        transform: translateX(4px);
    }

    .wishlist-item:last-child {
        border-bottom: none;
    }

    /* Product Image */
    .wishlist-item-image {
        width: 120px;
        height: 120px;
        border-radius: var(--radius-lg);
        overflow: hidden;
        position: relative;
        flex-shrink: 0;
        background: var(--bg-light);
    }

    .wishlist-item-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .wishlist-item:hover .wishlist-item-image img {
        transform: scale(1.05);
    }

    .product-badge {
        position: absolute;
        top: 8px;
        left: 8px;
        background: var(--primary-color);
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: 600;
        z-index: 2;
    }

    /* Product Details */
    .wishlist-item-details {
        flex: 1;
        margin-left: 24px;
        min-width: 0; /* Prevents flex item from overflowing */
    }

    .wishlist-item-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 8px;
        line-height: 1.4;
    }

    .wishlist-item-title a {
        color: inherit;
        text-decoration: none;
        transition: color 0.3s ease;
    }

    .wishlist-item-title a:hover {
        color: var(--primary-color);
    }

    .wishlist-item-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        margin-bottom: 12px;
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 6px;
        color: var(--text-medium);
        font-size: 14px;
        font-weight: 500;
    }

    .meta-icon {
        color: var(--primary-color);
        font-size: 12px;
    }

    .wishlist-item-rating {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 12px;
    }

    .rating-stars {
        display: flex;
        gap: 2px;
    }

    .rating-star {
        color: #fbbf24;
        font-size: 14px;
    }

    .rating-text {
        font-size: 12px;
        color: var(--text-light);
    }

    .wishlist-item-description {
        color: var(--text-medium);
        font-size: 14px;
        line-height: 1.5;
        margin-bottom: 16px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* Price and Actions */
    .wishlist-item-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid var(--border-light);
    }

    .wishlist-item-price {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .price-current {
        font-size: 20px;
        font-weight: 700;
        color: var(--primary-color);
    }

    .price-original {
        font-size: 16px;
        color: var(--text-light);
        text-decoration: line-through;
    }

    .stock-status {
        font-size: 12px;
        font-weight: 600;
        padding: 4px 8px;
        border-radius: 20px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .in-stock {
        background: rgba(16, 185, 129, 0.1);
        color: #059669;
    }

    .out-of-stock {
        background: rgba(220, 38, 38, 0.1);
        color: #dc2626;
    }

    /* Action Buttons */
    .wishlist-item-actions {
        display: flex;
        gap: 12px;
        align-items: center;
    }

    .btn-add-to-cart {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn-add-to-cart:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(253, 91, 68, 0.3);
    }

    .btn-add-to-cart:disabled {
        background: var(--text-light);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    .btn-remove {
        background: none;
        color: #dc2626;
        border: 2px solid #dc2626;
        padding: 10px 16px;
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .btn-remove:hover {
        background: #dc2626;
        color: white;
        transform: translateY(-1px);
    }

    .btn-view-details {
        background: white;
        color: var(--primary-color);
        border: 2px solid var(--primary-color);
        padding: 10px 16px;
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .btn-view-details:hover {
        background: var(--primary-color);
        color: white;
        transform: translateY(-1px);
    }

    /* Empty Wishlist State */
    .empty-wishlist {
        text-align: center;
        padding: 80px 32px;
        color: var(--text-light);
        background: white;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-lg);
    }

    .empty-wishlist i {
        font-size: 64px;
        margin-bottom: 24px;
        opacity: 0.5;
        color: var(--primary-color);
    }

    .empty-wishlist h3 {
        font-size: 24px;
        margin-bottom: 12px;
        color: var(--text-dark);
        font-weight: 600;
    }

    .empty-wishlist p {
        font-size: 16px;
        margin-bottom: 32px;
        color: var(--text-medium);
    }

    .btn-start-shopping {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 14px 28px;
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        text-decoration: none;
    }

    .btn-start-shopping:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(253, 91, 68, 0.3);
    }

    /* Added to Cart Animation */
    .added-to-cart {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #10b981;
        color: white;
        padding: 12px 20px;
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-lg);
        z-index: 1000;
        font-weight: 500;
        font-size: 14px;
        transform: translateX(100%);
        transition: transform 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .added-to-cart.show {
        transform: translateX(0);
    }

    /* Responsive Design */
    @@media (max-width: 768px) {
        .wishlist-container {
            padding: 40px 0;
        }

        .wishlist-header, .wishlist-items {
            margin: 0 16px;
        }

        .wishlist-item {
            flex-direction: column;
            align-items: flex-start;
            padding: 20px;
            text-align: left;
        }

        .wishlist-item-image {
            width: 100%;
            height: 200px;
            margin-bottom: 16px;
        }

        .wishlist-item-details {
            margin-left: 0;
            width: 100%;
        }

        .wishlist-item-footer {
            flex-direction: column;
            align-items: flex-start;
            gap: 16px;
        }

        .wishlist-item-actions {
            width: 100%;
            justify-content: space-between;
        }

        .wishlist-actions {
            flex-direction: column;
            align-items: stretch;
            gap: 16px;
        }

        .wishlist-controls {
            justify-content: space-between;
            width: 100%;
        }
    }

    @@media (max-width: 480px) {
        .wishlist-item-actions {
            flex-direction: column;
            width: 100%;
        }

        .btn-add-to-cart,
        .btn-view-details,
        .btn-remove {
            width: 100%;
            justify-content: center;
        }
    }

    /* Animation for item removal */
    .wishlist-item.removing {
        animation: slideOut 0.3s ease-out forwards;
    }

    @@keyframes slideOut {
        0% {
            opacity: 1;
            transform: translateX(0);
        }
        100% {
            opacity: 0;
            transform: translateX(-100%);
        }
    }

    /* Loading animation */
    .btn-loading {
        position: relative;
        overflow: hidden;
    }

    .btn-loading::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        animation: loading 1s infinite;
    }

    @@keyframes loading {
        0% { left: -100%; }
        100% { left: 100%; }
    }
</style>

<!-- Breadcrumb -->
<div class="breadcumb-wrapper background-image" style="background-image: url('/assets/img/bg/breadcumb-bg.jpg');">
    <div class="container">
        <div class="breadcumb-content">
            <h1 class="breadcumb-title">My Wishlist</h1>
            <ul class="breadcumb-menu">
                <li><a asp-controller="Base" asp-action="Home">Home</a></li>
                <li>Wishlist</li>
            </ul>
        </div>
    </div>
</div>

<!-- Main Wishlist Container -->
<div class="wishlist-container">
    <div class="container">
        <!-- Wishlist Header -->
        <div class="wishlist-header">
            <h1 class="wishlist-title">
                <i class="fas fa-heart"></i>
                My Wishlist
            </h1>
            <p class="wishlist-subtitle">Save your favorite items for later</p>
            
            <div class="wishlist-actions">
                <div class="wishlist-count" id="wishlistCount">
                    @if (Model?.WishlistItems?.Count() > 0)
                    {
                        <text>@Model.WishlistItems.Count() items in your wishlist</text>
                    }
                    else
                    {
                        <text>Your wishlist is empty</text>
                    }
                </div>
                <div class="wishlist-controls">
                    @if (Model?.WishlistItems?.Count() > 0)
                    {
                        <button type="button" class="btn-clear-all" onclick="clearAllWishlist()">
                            <i class="fas fa-trash"></i>
                            Clear All
                        </button>
                    }
                    <button type="button" class="btn-share" onclick="shareWishlist()">
                        <i class="fas fa-share"></i>
                        Share Wishlist
                    </button>
                </div>
            </div>
        </div>

        <!-- Wishlist Items -->
        @if (Model?.WishlistItems?.Count() > 0)
        {
            <div class="wishlist-items" id="wishlistItems">
                @foreach (var item in Model.WishlistItems)
                {
                    <div class="wishlist-item" id="wishlist-item-@item.productId">
                        <!-- Product Image -->
                        <div class="wishlist-item-image">
                            <img src="@item.product.MainPhotoPath" alt="@item.product.Name">
                            @{
                                var daysCount = (DateTime.Now - item.product.CreatedOn).Days;
                                if (item.product.IsSale)
                                {
                                    <span class="product-badge">Sale</span>
                                }
                                else if (daysCount < 20)
                                {
                                    <span class="product-badge">New</span>
                                }
                            }
                        </div>

                        <!-- Product Details -->
                        <div class="wishlist-item-details">
                            <h3 class="wishlist-item-title">
                                <a href="#" onclick="viewProduct(@item.productId)">@item.product.Name</a>
                            </h3>

                            <div class="wishlist-item-meta">
                                <div class="meta-item">
                                    <i class="fas fa-layer-group meta-icon"></i>
                                    <span>@item.product.category?.Name</span>
                                </div>
                                <div class="meta-item">
                                    <i class="fas fa-calendar-plus meta-icon"></i>
                                    <span>Added @item.CreatedOn.ToString("MMM dd, yyyy")</span>
                                </div>
                            </div>

                            <div class="wishlist-item-rating">
                                <div class="rating-stars">
                                    @for (int i = 0; i < 5; i++)
                                    {
                                        if (i < item.product.ReviewRate)
                                        {
                                            <i class="fas fa-star rating-star"></i>
                                        }
                                        else
                                        {
                                            <i class="fal fa-star rating-star" style="color: #e2e8f0;"></i>
                                        }
                                    }
                                </div>
                                <span class="rating-text">(@item.product.ReviewCount reviews)</span>
                            </div>

                            <p class="wishlist-item-description">@item.product.Description</p>

                            <div class="wishlist-item-footer">
                                <div class="wishlist-item-price">
                                    @if (item.product.Discount != null)
                                    {
                                        <span class="price-current">@Math.Round((decimal)item.product.AfterDiscount, 2) EGP</span>
                                        <span class="price-original">@Math.Round((decimal)item.product.Price, 2) EGP</span>
                                    }
                                    else
                                    {
                                        <span class="price-current">@item.product.Price EGP</span>
                                    }
                                </div>
                                
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    @if (item.product.stock?.Quantity > 0)
                                    {
                                        <span class="stock-status in-stock">In Stock</span>
                                    }
                                    else
                                    {
                                        <span class="stock-status out-of-stock">Out of Stock</span>
                                    }
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="wishlist-item-actions">
                            @if (item.product.stock?.Quantity > 0)
                            {
                                <button class="btn-add-to-cart" onclick="addToCart(@item.productId)">
                                    <i class="fas fa-shopping-cart"></i>
                                    Add to Cart
                                </button>
                            }
                            else
                            {
                                <button class="btn-add-to-cart" disabled>
                                    <i class="fas fa-ban"></i>
                                    Out of Stock
                                </button>
                            }
                            
                            
                            <button class="btn-remove" onclick="removeFromWishlist(@item.productId)">
                                <i class="fas fa-times"></i>
                                Remove
                            </button>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <!-- Empty Wishlist State -->
            <div class="empty-wishlist">
                <i class="fas fa-heart-broken"></i>
                <h3>Your wishlist is empty</h3>
                <p>Start adding products to your wishlist by clicking the heart icon on any product.</p>
                <a href="@Url.Action("Index", "Base")" class="btn-start-shopping">
                    <i class="fas fa-shopping-bag"></i>
                    Start Shopping
                </a>
            </div>
        }
    </div>
</div>

<script>
    // Wishlist Management Functions
    function addToCart(productId) {
        const btn = event.target;
        const originalHTML = btn.innerHTML;
        
        // Add loading state
        btn.classList.add('btn-loading');
        btn.innerHTML = '<div style="width: 20px; height: 20px; border: 2px solid rgba(255,255,255,0.3); border-top: 2px solid white; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>';
        btn.disabled = true;

        // Simulate API call
        setTimeout(() => {
            btn.classList.remove('btn-loading');
            btn.innerHTML = '<i class="fas fa-check"></i>Added!';
            btn.style.background = '#10b981';

            // Show success notification
            showNotification('Product added to cart successfully!', 'success');

            setTimeout(() => {
                btn.innerHTML = originalHTML;
                btn.style.background = '';
                btn.disabled = false;
            }, 2000);

            // Here you would make the actual AJAX call to add to cart
            console.log('Added product to cart:', productId);
        }, 1000);
    }

    function removeFromWishlist(productId) {
        if (confirm('Are you sure you want to remove this item from your wishlist?')) {
            const itemElement = document.getElementById(`wishlist-item-${productId}`);
            
            // Add removal animation
            itemElement.classList.add('removing');
            
            setTimeout(() => {
                itemElement.remove();
                updateWishlistCount();
                showNotification('Item removed from wishlist', 'info');
                
                // Check if wishlist is now empty
                const remainingItems = document.querySelectorAll('.wishlist-item').length;
                if (remainingItems === 0) {
                    location.reload(); // Reload to show empty state
                }
            }, 300);

            // Here you would make the actual AJAX call to remove from wishlist
            console.log('Removed product from wishlist:', productId);
        }
    }

    function clearAllWishlist() {
        if (confirm('Are you sure you want to clear your entire wishlist? This action cannot be undone.')) {
            const items = document.querySelectorAll('.wishlist-item');
            
            items.forEach((item, index) => {
                setTimeout(() => {
                    item.classList.add('removing');
                    setTimeout(() => item.remove(), 300);
                }, index * 100);
            });

            setTimeout(() => {
                location.reload(); // Reload to show empty state
            }, items.length * 100 + 500);

            showNotification('Wishlist cleared successfully', 'info');
            
            // Here you would make the actual AJAX call to clear wishlist
            console.log('Cleared entire wishlist');
        }
    }

    function shareWishlist() {
        if (navigator.share) {
            navigator.share({
                title: 'Check out my wishlist!',
                text: 'Take a look at the products I\'m interested in',
                url: window.location.href
            });
        } else {
            // Fallback for browsers that don't support Web Share API
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                showNotification('Wishlist link copied to clipboard!', 'success');
            }).catch(() => {
                // Create a temporary input to copy the URL
                const tempInput = document.createElement('input');
                tempInput.value = url;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                showNotification('Wishlist link copied to clipboard!', 'success');
            });
        }
    }

    function viewProduct(productId) {
        // Navigate to product details page
        window.location.href = `/Product/Details/${productId}`;
    }

    function updateWishlistCount() {
        const items = document.querySelectorAll('.wishlist-item').length;
        const countElement = document.getElementById('wishlistCount');
        
        if (items === 0) {
            countElement.textContent = 'Your wishlist is empty';
        } else {
            countElement.textContent = `${items} item${items !== 1 ? 's' : ''} in your wishlist`;
        }
    }

    function showNotification(message, type = 'info') {
        // Remove existing notification
        const existing = document.querySelector('.notification');
        if (existing) existing.remove();

        // Create notification element
        const notification = document.createElement('div');
        notification.className = 'added-to-cart';
        
        const bgColor = {
            'success': '#10b981',
            'error': '#dc2626',
            'info': '#3b82f6'
        };

        notification.style.background = bgColor[type] || bgColor.info;
        notification.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}"></i>
            ${message}
        `;

        document.body.appendChild(notification);

        // Animate in
        setTimeout(() => {
            notification.classList.add('show');
        }, 100);

        // Animate out and remove
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 300);
        }, 3000);
    }

    // Add CSS for spin animation
    const style = document.createElement('style');
    style.textContent = `
        @@keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    `;
    document.head.appendChild(style);

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        // Add smooth scroll behavior
        document.documentElement.style.scrollBehavior = 'smooth';

        // Intersection Observer for wishlist items animation
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateX(0)';
                }
            });
        }, observerOptions);

        // Observe all wishlist items
        document.querySelectorAll('.wishlist-item').forEach((item, index) => {
            item.style.opacity = '0';
            item.style.transform = 'translateX(-30px)';
            item.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
            observer.observe(item);
        });
    });
</script>